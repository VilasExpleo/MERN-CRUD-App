<p-contextMenu appendTo="body" #cm [model]="textnodeHistoryService.columnConfigMenu"> </p-contextMenu>
<p-table
    [columns]="tableColumns"
    [lazy]="true"
    [value]="textnodeHistoryService.historyData"
    (onLazyLoad)="textnodeHistoryService.historyLazyLoadEvent($event)"
    [contextMenu]="cm"
    [(contextMenuSelection)]="textnodeHistoryService.historyForCM"
>
    <ng-template pTemplate="header" let-columns>
        <tr [pContextMenuRow]="textnodeHistoryService.historyForCM">
            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                {{ col.header }}
                <p-columnFilter
                    [type]="col.filterType"
                    [field]="col.field"
                    display="menu"
                    [hideOnClear]="true"
                ></p-columnFilter>
                <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr [pContextMenuRow]="textnodeHistoryService.historyForCM">
            <td *ngFor="let col of columns">
                <ng-container
                    *ngIf="col.field === 'new_value' || col.field === 'old_value'; then showValues; else noFormatValues"
                ></ng-container>
                <ng-template #showValues>
                    <ng-container
                        *ngIf="
                            rowData['attribute_name'] !== 'Source Text';
                            then showValuesInChip;
                            else showValueDifference
                        "
                    ></ng-container>
                    <ng-template #showValuesInChip>
                        <p-chip
                            [label]="rowData[col.field]"
                            [icon]="textNodeIcon[rowData[col.field]]"
                            [styleClass]="'text-node-status ' + rowData[col.field]"
                        ></p-chip>
                    </ng-template>
                    <ng-template #showValueDifference>
                        <app-diffrence-element
                            *ngIf="
                                col.field === 'new_value' && rowData['attribute_name'] === 'Source Text';
                                else noFormatValues
                            "
                            [oldValue]="rowData?.['old_value']"
                            [newValue]="rowData?.['new_value']"
                        ></app-diffrence-element>
                    </ng-template>
                </ng-template>
                <ng-template #noFormatValues>
                    {{ rowData[col.field] }}
                </ng-template>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td [attr.colspan]="textnodeHistoryService.historyData">No history found.</td>
        </tr>
    </ng-template>
</p-table>
