<div class="main-dashborad">
    <div class="h-full">
        <p-contextMenu #cm [model]="contextMenuItems" appendTo="body"></p-contextMenu>

        <igc-dockmanager [layout]="IgcDockManagerLayout">
            <div slot="{{ contentId }}" class="dockManagerContent">
                <p-table
                    #dt
                    [value]="projects"
                    [(selection)]="selectedProject"
                    dataKey="translationRequestId"
                    [rowHover]="true"
                    [rows]="10"
                    [showCurrentPageReport]="true"
                    [loading]="loading"
                    [paginator]="projects.length > 0"
                    [filterDelay]="0"
                    (onRowExpand)="updateStatusOnExpand($event.data)"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th id="first-column"></th>
                            <th id="Project">
                                Project
                                <p-columnFilter
                                    type="text"
                                    field="projectName"
                                    display="menu"
                                    [hideOnClear]="true"
                                ></p-columnFilter>
                            </th>
                            <th id="version" pSortableColumn="versionId">
                                Version <p-sortIcon field="versionId"></p-sortIcon>
                                <p-columnFilter
                                    type="text"
                                    field="versionId"
                                    display="menu"
                                    [hideOnClear]="true"
                                ></p-columnFilter>
                            </th>
                            <th id="brand" pSortableColumn="brandName">
                                Brand
                                <p-sortIcon field="brandName"></p-sortIcon>
                                <p-columnFilter
                                    field="brandName"
                                    matchMode="equals"
                                    display="menu"
                                    [hideOnClear]="true"
                                >
                                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                        <p-dropdown
                                            [ngModel]="value"
                                            [options]="getBrandsName()"
                                            (onChange)="filter($event.value)"
                                            placeholder="Any"
                                        >
                                            <ng-template let-brand pTemplate="item">
                                                <span [class]="'customer-badge status-' + brand">
                                                    {{ brand }}
                                                </span>
                                            </ng-template>
                                        </p-dropdown>
                                    </ng-template>
                                </p-columnFilter>
                            </th>
                            <th id="due-date" pSortableColumn="dueDate">
                                Due Date <p-sortIcon field="dueDate"></p-sortIcon>
                            </th>
                            <th id="source" pSortableColumn="sourceLanguage.code">
                                Source <p-sortIcon field="sourceLanguage.code"></p-sortIcon>
                                <p-columnFilter
                                    type="text"
                                    field="sourceLanguage.code"
                                    display="menu"
                                    [hideOnClear]="true"
                                ></p-columnFilter>
                            </th>
                            <th id="status" pSortableColumn="status">
                                Order Status<p-sortIcon field="status"></p-sortIcon>
                                <p-columnFilter field="status" display="menu" [showMatchModes]="false">
                                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                        <p-dropdown
                                            [options]="orderStatus"
                                            (onChange)="filter($event.value.id)"
                                            placeholder="proofread status"
                                            [ngModel]="value"
                                        >
                                            <ng-template let-option pTemplate="item">
                                                <div class="inline-block vertical-align-middle">
                                                    <p-chip
                                                        [label]="option.label"
                                                        [icon]="tableIcons[option.label]"
                                                        [styleClass]="'text-node-status ' + option.label"
                                                    ></p-chip>
                                                </div>
                                            </ng-template>
                                        </p-dropdown>
                                    </ng-template>
                                </p-columnFilter>
                            </th>
                            <th id="attachments">Attachments</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-project let-expanded="expanded">
                        <tr
                            (contextmenu)="selectTranslationRequest(project)"
                            (click)="selectTranslationRequest(project)"
                            [pSelectableRow]="project"
                        >
                            <td>
                                <button
                                    type="button"
                                    pButton
                                    pRipple
                                    [pRowToggler]="project"
                                    class="p-button-text p-button-rounded p-button-plain"
                                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                                ></button>
                            </td>
                            <td>{{ project.projectName }}</td>
                            <td>{{ getVersion(project.versionId) }}</td>
                            <td>
                                <img src="{{ project.brandUrl }}" alt="logo" />
                            </td>
                            <td>
                                <span [ngClass]="getCSSClassForDueDate(project)">
                                    <i
                                        *ngIf="getCSSClassForDueDate(project) !== 'ok'"
                                        class="pi pi-exclamation-triangle ml-2"
                                        aria-hidden="true"
                                    ></i>
                                    {{ project.dueDate | date : 'yyyy-MM-dd' }}
                                </span>
                            </td>
                            <td>
                                <div class="m-3 h-2rem w-max pt-1 border-round-3xl" style="background-color: #dee2e6">
                                    <span class="m-4 text-center">{{ project.sourceLanguage.code }}</span>
                                </div>
                            </td>
                            <td>
                                <span [class]="'text-node-status ' + getColorClassForStatus(project.status)">
                                    <i
                                        [ngStyle]="{
                                            color: getColorForProofreadStatus(project.status)
                                        }"
                                        [ngClass]="ProofreadStatus[project.status]"
                                        aria-hidden="true"
                                    >
                                    </i>
                                    {{ ProjectProofreadStatus[project['status']] }}
                                </span>
                            </td>
                            <td>
                                <p-chip
                                    *ngIf="project.document === 'yes'; else no"
                                    icon="pi pi-file"
                                    [label]="project.documentCount"
                                ></p-chip>
                                <ng-template #no>-</ng-template>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="rowexpansion" let-project>
                        <tr>
                            <td colspan="11">
                                <div class="p-p-3">
                                    <p-table
                                        [value]="project.languages"
                                        dataKey="project.languages.id"
                                        [scrollable]="true"
                                        [contextMenu]="cm"
                                    >
                                        <ng-template pTemplate="header">
                                            <tr>
                                                <th id="translator-name" pSortableColumn="translatorName">
                                                    Translator
                                                    <p-sortIcon field="translatorName"></p-sortIcon>
                                                    <p-columnFilter
                                                        type="text"
                                                        field="translatorName"
                                                        display="menu"
                                                        [hideOnClear]="true"
                                                    ></p-columnFilter>
                                                </th>
                                                <th id="progress" pSortableColumn="progress">
                                                    Translation Progress
                                                    <p-sortIcon field="progress"></p-sortIcon>
                                                </th>
                                                <th>Proofread Status</th>
                                                <th id="returnDate" pSortableColumn="returnDate">
                                                    Returned
                                                    <p-sortIcon field="returnDate"></p-sortIcon>
                                                    <p-columnFilter
                                                        type="date"
                                                        field="returnDate"
                                                        display="menu"
                                                        [hideOnClear]="true"
                                                    ></p-columnFilter>
                                                </th>
                                            </tr>
                                        </ng-template>
                                        <ng-template pTemplate="body" let-order>
                                            <tr
                                                [pSelectableRow]="order"
                                                [pContextMenuRow]="order"
                                                (contextmenu)="getSelectedProjectData(project, order)"
                                            >
                                                <td>{{ order.translatorName }}</td>
                                                <td>
                                                    <div class="main border-round-3xl grid">
                                                        <div class="col-3">
                                                            <span>{{ order.targetLanguage.code }}</span>
                                                        </div>
                                                        <div class="col-6">
                                                            <p-progressBar
                                                                [value]="order.progress"
                                                                [showValue]="true"
                                                                minValue="0"
                                                                [style]="{
                                                                    height: '1rem',
                                                                    'background-color': 'white'
                                                                }"
                                                            ></p-progressBar>
                                                        </div>
                                                        <div class="col-3" style="color: #3b82f6">
                                                            <span>{{ order.progress }}%</span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <p-chip
                                                        [label]="order.pendingNodes"
                                                        icon="icon-pending"
                                                        styleClass="mr-2 text-node-status Pending"
                                                    ></p-chip>

                                                    <p-chip
                                                        [label]="order.proofreadNodes"
                                                        icon="icon-pending"
                                                        styleClass="mr-2 text-node-status Approved"
                                                    ></p-chip>

                                                    <p-chip
                                                        [label]="order.rejectedNodes"
                                                        icon="icon-pending"
                                                        styleClass="mr-2 text-node-status Rejected"
                                                    ></p-chip>
                                                </td>
                                                <td>
                                                    <span *ngIf="order.returnDate; else elseBlock">{{
                                                        order.returnDate | date : 'yyyy-MM-dd'
                                                    }}</span>
                                                    <ng-template #elseBlock>
                                                        <p-chip label="not returned" styleClass="mr-2"></p-chip>
                                                    </ng-template>
                                                </td>
                                            </tr>
                                        </ng-template>
                                    </p-table>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
            <div slot="document" class="dockManagerContent bg-white p-3 h-full w-full">
                <app-view-documents
                    *ngIf="projects.length !== 0"
                    [selectedProject]="selectedProject"
                    role="proofreader"
                    [translation_request_id]="selectedProject.translationRequestId"
                ></app-view-documents>
                <app-checklist
                    [checklist]="checklist"
                    [header]="'Translation Checklist'"
                    [isToggle]="true"
                    [showCheckbox]="false"
                ></app-checklist>
            </div>
        </igc-dockmanager>
    </div>
</div>
